# Justfile for torus-client

# Default network
default_net := "mainnet"

# Download metadata for a given network (default: mainnet)
download_metadata net=default_net:
    @echo "Downloading metadata for {{net}} network..."
    ./scripts/get-metadata.sh {{net}}
    @echo "Metadata downloaded to data/metadata/{{net}}.scale"

# Generate interfaces from metadata for a given network (default: mainnet)
gen_interfaces net=default_net: (download_metadata net)
    @echo "Generating interfaces for {{net}} network..."
    subxt codegen --file data/metadata/{{net}}.scale | rustfmt > src/interfaces/{{net}}.rs
    @echo "Generated interfaces in src/interfaces/{{net}}.rs"

# Generate storage wrappers for a given network (default: mainnet)
gen_wrappers net=default_net:
    @echo "Generating storage wrappers for {{net}} network..."
    mkdir -p src/wrappers
    cargo run --bin generate_wrappers -- --source {{net}} --output src/wrappers/{{net}}.rs --force
    @echo "Generated storage wrappers in src/wrappers/{{net}}.rs"

# Generate both interfaces and wrappers for a given network (default: mainnet)
gen_complete net=default_net: (gen_interfaces net) (gen_wrappers net)
    @echo "Generated complete API for {{net}} network"

# Generate interfaces for live networks (mainnet and testnet)
gen_for_live: (gen_interfaces "mainnet") (gen_interfaces "testnet")
    @echo "Live network interfaces generated successfully"

# Generate complete APIs (interfaces + wrappers) for live networks
gen_complete_live: (gen_complete "mainnet") (gen_complete "testnet")
    @echo "Complete live network APIs generated successfully"

# Build the client library
build:
    @echo "Building torus-client..."
    cargo build --package torus-client

# Run tests for the client library
test:
    @echo "Running tests for torus-client..."
    cargo test --package torus-client

# Clean build artifacts and optionally metadata
clean:
    @echo "Cleaning build artifacts..."
    cargo clean --package torus-client
    # rm -rf data/metadata/*.scale
    @echo "Cleaned build artifacts"
